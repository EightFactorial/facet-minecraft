//! Tests for serializing and deserializing variable-length [`u128`]s.
#![allow(clippy::unreadable_literal, reason = "Just a test")]

use facet_minecraft::{Standard, deserialize::Deserializer, serialize::Serializer};

#[test]
#[rustfmt::skip]
fn verify() {
    assert_eq(0, vec![0]);
    assert_eq(1, vec![1]);
    assert_eq(2, vec![2]);
    assert_eq(3, vec![3]);
    assert_eq(4, vec![4]);
    assert_eq(5, vec![5]);
    assert_eq(6, vec![6]);
    assert_eq(7, vec![7]);
    assert_eq(8, vec![8]);

    assert_eq(126, vec![126]);
    assert_eq(127, vec![127]);
    assert_eq(128, vec![128, 1]);
    assert_eq(129, vec![129, 1]);
    assert_eq(130, vec![130, 1]);

    assert_eq(253, vec![253, 1]);
    assert_eq(254, vec![254, 1]);
    assert_eq(255, vec![255, 1]);
    assert_eq(256, vec![128, 2]);
    assert_eq(257, vec![129, 2]);
    assert_eq(258, vec![130, 2]);

    assert_eq(25563, vec![219, 199, 1]);
    assert_eq(25564, vec![220, 199, 1]);
    assert_eq(25565, vec![221, 199, 1]);
    assert_eq(25566, vec![222, 199, 1]);
    assert_eq(25567, vec![223, 199, 1]);

    assert_eq(65530, vec![250, 255, 3]);
    assert_eq(65531, vec![251, 255, 3]);
    assert_eq(65532, vec![252, 255, 3]);
    assert_eq(65533, vec![253, 255, 3]);
    assert_eq(65534, vec![254, 255, 3]);
    assert_eq(65535, vec![255, 255, 3]);

    assert_eq(2097150, vec![254, 255, 127]);
    assert_eq(2097151, vec![255, 255, 127]);
    assert_eq(2097152, vec![128, 128, 128, 1]);
    assert_eq(2097153, vec![129, 128, 128, 1]);
    assert_eq(2097154, vec![130, 128, 128, 1]);

    assert_eq(2147483646, vec![254, 255, 255, 255, 7]);
    assert_eq(2147483647, vec![255, 255, 255, 255, 7]);
    assert_eq(2147483648, vec![128, 128, 128, 128, 8]);
    assert_eq(2147483649, vec![129, 128, 128, 128, 8]);
    assert_eq(2147483650, vec![130, 128, 128, 128, 8]);

    assert_eq(4294967290, vec![250, 255, 255, 255, 15]);
    assert_eq(4294967291, vec![251, 255, 255, 255, 15]);
    assert_eq(4294967292, vec![252, 255, 255, 255, 15]);
    assert_eq(4294967293, vec![253, 255, 255, 255, 15]);
    assert_eq(4294967294, vec![254, 255, 255, 255, 15]);
    assert_eq(4294967295, vec![255, 255, 255, 255, 15]);
    assert_eq(4294967296, vec![128, 128, 128, 128, 16]);
    assert_eq(4294967297, vec![129, 128, 128, 128, 16]);
    assert_eq(4294967298, vec![130, 128, 128, 128, 16]);

    assert_eq(9223372036854775804, vec![252, 255, 255, 255, 255, 255, 255, 255, 127]);
    assert_eq(9223372036854775805, vec![253, 255, 255, 255, 255, 255, 255, 255, 127]);
    assert_eq(9223372036854775806, vec![254, 255, 255, 255, 255, 255, 255, 255, 127]);
    assert_eq(9223372036854775807, vec![255, 255, 255, 255, 255, 255, 255, 255, 127]);
    assert_eq(9223372036854775808, vec![128, 128, 128, 128, 128, 128, 128, 128, 128, 1]);
    assert_eq(9223372036854775809, vec![129, 128, 128, 128, 128, 128, 128, 128, 128, 1]);
    assert_eq(9223372036854775810, vec![130, 128, 128, 128, 128, 128, 128, 128, 128, 1]);

    assert_eq(18446744073709551610, vec![250, 255, 255, 255, 255, 255, 255, 255, 255, 1]);
    assert_eq(18446744073709551611, vec![251, 255, 255, 255, 255, 255, 255, 255, 255, 1]);
    assert_eq(18446744073709551612, vec![252, 255, 255, 255, 255, 255, 255, 255, 255, 1]);
    assert_eq(18446744073709551613, vec![253, 255, 255, 255, 255, 255, 255, 255, 255, 1]);
    assert_eq(18446744073709551614, vec![254, 255, 255, 255, 255, 255, 255, 255, 255, 1]);
    assert_eq(18446744073709551615, vec![255, 255, 255, 255, 255, 255, 255, 255, 255, 1]);
    assert_eq(18446744073709551616, vec![128, 128, 128, 128, 128, 128, 128, 128, 128, 2]);
    assert_eq(18446744073709551617, vec![129, 128, 128, 128, 128, 128, 128, 128, 128, 2]);
    assert_eq(18446744073709551618, vec![130, 128, 128, 128, 128, 128, 128, 128, 128, 2]);

    assert_eq(340282366920938463463374607431768211450, vec![250, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 3]);
    assert_eq(340282366920938463463374607431768211451, vec![251, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 3]);
    assert_eq(340282366920938463463374607431768211452, vec![252, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 3]);
    assert_eq(340282366920938463463374607431768211453, vec![253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 3]);
    assert_eq(340282366920938463463374607431768211454, vec![254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 3]);
    assert_eq(340282366920938463463374607431768211455, vec![255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 3]);
}

fn assert_eq(var: u128, bytes: Vec<u8>) {
    let mut buffer = Vec::new();
    Standard.serialize_var_u128(var, &mut buffer).unwrap();
    assert_eq!(buffer, bytes, "Expected {var} to serialize as {bytes:?}!");

    let (de, rem) = Standard.deserialize_var_u128(&bytes).unwrap();
    assert_eq!(de, var, "Expected {bytes:?} to deserialize as {var}!");
    assert!(rem.is_empty(), "Found remaining bytes after deserialization: {rem:?}!");
}
